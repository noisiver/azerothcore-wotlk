import colorama
import git
import hashlib
import os
import pymysql
import subprocess

if os.name == 'nt':
    colorama.just_fix_windows_console()

mysql = {
    'host': '127.0.0.1',
    'port': 3306,
    'username': 'acore',
    'password': 'acore',
    'base': 'base_world',
    'progression': 'progression_world'
}

windows_paths = {
    'mysql': 'C:/Program Files/MySQL/MySQL Server 8.4'
}

# table name, type (min/max or patch), add column(s) after this column, primary keys with new columns, delete queries before inserts
tables = [
    [
        'areatrigger', # DONE
        0,
        'orientation',
        '`entry`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `areatrigger` WHERE `entry`=4055;'
    ],
    [
        'areatrigger_teleport', # DONE
        0,
        'target_orientation',
        '`ID`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `areatrigger_teleport` WHERE `ID` IN (4055, 5196, 5197, 5198, 5199);'
    ],
    [
        'broadcast_text', # DONE
        1,
        'ID',
        '`ID`, `Patch`',
        'DELETE FROM `broadcast_text` WHERE `ID`=8106;'
    ],
    [
        'conditions', # NOT DONE
        0,
        'Comment',
        '`SourceTypeOrReferenceId`, `SourceGroup`, `SourceEntry`, `SourceId`, `ElseGroup`, `ConditionTypeOrReference`, `ConditionTarget`, `ConditionValue1`, `ConditionValue2`, `ConditionValue3`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `conditions` WHERE `SourceTypeOrReferenceId`=4 AND `SourceGroup`=17280 AND `SourceEntry` IN (19803, 19805, 19806, 19807, 19808);\nDELETE FROM `conditions` WHERE `SourceTypeOrReferenceId`=4 AND `SourceGroup` IN (25662, 25663, 25664, 25665, 25668, 25669, 25670, 25671, 25673, 25674) AND `SourceEntry`=50289;\nDELETE FROM `conditions` WHERE `SourceTypeOrReferenceId`=10 AND `SourceGroup` IN (11019, 11020, 11021, 11022) AND `SourceEntry`=50289;\nDELETE FROM `conditions` WHERE `SourceTypeOrReferenceId`=10 AND `SourceGroup`=11150;\nDELETE FROM `conditions` WHERE `SourceTypeOrReferenceId`=1 AND `SourceEntry` IN (17008, 18422, 18423, 21103, 21104, 21105, 21108, 21110, 49205, 49643, 49644);\nDELETE FROM `conditions` WHERE `SourceTypeOrReferenceId`=1 AND `SourceGroup` IN (69, 299) AND `SourceEntry` IN (750, 50432);'
    ],
    [
        'creature', # DONE
        0,
        'Comment', '`guid`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `creature` WHERE `id1` IN (1747, 1748, 1749, 1756, 2425, 2941, 3083, 3305, 4314, 6109, 8196, 8197, 8198, 10378, 10583, 11036, 11099, 11832, 12239, 12397, 12779, 12780, 12786, 12787, 12789, 12790, 12791, 12797, 12798, 13217, 13219, 13697, 13776, 13777, 13816, 13817, 13839, 13840, 13841, 13842, 13843, 14284, 14285, 14304, 14373, 14387, 14622, 14624, 14625, 14626, 14627, 14628, 14634, 14637, 14721, 14730, 14731, 14734, 14736, 14737, 14738, 14739, 14740, 14741, 14743, 14875, 14876, 14887, 14888, 14889, 14890, 14902, 14903, 14904, 14905, 14910, 14911, 14912, 14921, 15070, 15076, 15080, 15165, 15170, 15171, 15172, 15174, 15175, 15176, 15177, 15178, 15179, 15180, 15181, 15182, 15183, 15184, 15185, 15187, 15188, 15189, 15190, 15191, 15192, 15270, 15282, 15306, 15350, 15351, 15419, 15440, 15441, 15442, 15443, 15444, 15481, 15498, 15499, 15500, 15540, 15612, 15613, 15614, 15615, 15616, 15617, 15659, 15675, 15676, 15677, 15678, 15679, 15681, 15682, 15683, 15684, 15686, 15693, 15722, 15903, 16012, 16013, 16091, 16112, 16113, 16114, 16115, 16116, 16131, 16132, 16133, 16134, 16135, 16212, 16225, 16226, 16227, 16256, 16283, 16284, 16287, 16288, 16376, 16378, 16392, 16543, 16840, 16841, 17068, 17069, 17070, 17072, 17079, 17080, 17081, 17082, 17092, 17093, 17094, 17095, 17097, 17098, 17099, 17100, 17103, 17104, 17105, 17106, 17108, 17109, 17119, 17127, 17218, 17223, 17238, 17249, 17291, 17303, 17406, 17409, 17412, 17531, 17541, 17598, 17613, 17765, 17766, 18165, 18221, 18253, 18255, 19202, 19254, 19848, 19850, 19855, 19860, 19905, 19906, 19907, 19908, 19909, 19910, 19911, 20406, 20407, 20797, 21045, 21448, 22834, 22835, 22837, 22889, 22902, 22931, 22935, 22936, 23090, 23127, 23128, 23131, 23449, 23534, 23535, 23536, 23567, 23570, 23571, 23572, 23573, 23579, 23612, 23636, 23797, 23995, 24208, 24366, 24369, 24370, 24410, 24437, 24456, 24729, 24833, 24834, 24835, 24836, 24837, 24838, 24839, 24840, 24841, 24842, 24843, 24851, 24854, 24924, 24926, 24927, 24929, 24930, 24931, 24932, 24934, 24935, 24993, 24995, 24996, 24997, 25007, 25009, 25010, 25011, 25012, 25013, 25014, 25015, 25016, 25017, 25018, 25019, 25020, 25021, 25022, 25023, 25024, 25025, 25070, 25071, 25072, 25074, 25076, 25077, 25079, 25080, 25081, 25083, 25134, 25135, 25136, 25137, 25138, 25140, 25141, 25142, 25143, 25153, 25155, 25167, 25171, 25885, 26537, 26539, 26548, 27666, 27667, 27703, 27705, 28092, 28126, 28601, 28602, 29093, 29095, 29141, 29142, 29143, 29287, 29288, 29289, 29290, 29291, 29292, 29293, 29294, 29295, 29296, 29297, 29298, 29299, 29300, 29346, 29611, 29725, 29728, 30706, 30709, 30710, 30711, 30713, 30715, 30716, 30717, 30721, 30722, 30723, 30724, 30727, 30729, 30730, 30731, 30732, 30733, 30734, 30735, 31144, 31146, 32666, 32667, 33211, 33224, 33303, 33608, 33609, 33610, 33611, 33612, 33613, 33614, 33615, 33616, 33617, 33618, 33619, 33621, 33623, 33638, 33679, 33963, 33964, 33993, 34015, 34038, 34043, 34060, 34063, 34075, 34078, 34081, 34244, 34765, 34771, 34772, 34788, 34794, 34880, 34881, 34885, 34912, 34914, 34955, 34976, 34978, 34988, 34991, 34997, 34998, 35007, 35008, 35013, 35068, 35073, 35093, 35099, 35100, 35101, 35143, 35281, 35364, 35365, 35469, 35470, 35471, 35472, 35473, 35482, 35483, 35494, 35495, 35499, 35501, 35573, 35574, 35575, 35576, 35577, 35578, 35579, 35580, 35587, 35594, 35596, 35597, 35598, 35599, 35600, 35601, 35602, 35603, 35607, 35611, 35612, 35790, 36065, 36066, 36101, 36102, 36217, 36224, 36225, 36273, 36479, 36481, 36506, 36517, 36669, 36670, 37776, 37780, 37888, 37915, 37941, 37942, 37965, 37967, 37968, 38433, 38482, 38493, 39263, 39275, 39349, 39368, 39386, 39396, 39675, 39711, 39715, 39716, 39717, 40160, 40607);\nDELETE FROM `creature` WHERE `guid` IN (17669, 28481, 28485, 28486, 28487, 28488, 28489, 28490, 33823, 33831, 34102, 34103, 34104, 34105, 34106, 34137, 34138, 34139, 38296, 38297, 38298, 38299, 38301, 38302, 38305, 39019, 39020, 39022, 39023, 39024, 39025, 39026, 41884, 41887, 41888, 41889, 41890, 41891, 41892, 41956, 41960, 41961, 41964, 65613, 79011, 79264, 79265, 79266, 79267, 92890, 96656, 96657, 96658, 203492, 203493, 203494, 203495, 246906, 246907, 246910, 246911, 246912, 246913, 246914);'
    ],
    [
        'creature_addon', # DONE
        0,
        'auras',
        '`guid`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `creature_addon` WHERE `guid` IN (10506, 10507, 10508, 10509, 10510, 10511, 10512, 10513, 10514, 10515, 10516, 10517, 10518, 10519, 10520, 10521, 10522, 10523, 10524, 10525, 10526, 10527, 10528, 51984, 79747, 5597, 24679, 24680, 24681, 24682, 24683, 24684, 5596, 92889, 52349, 15033, 23723, 53867, 42340, 29114, 133925, 133930, 133931, 16574, 16576, 29063, 16579, 16577, 16991, 16578, 16575, 16989, 703, 16583, 16584, 16585, 16586, 16587, 16588, 16589, 16590, 16591, 16592, 16593, 16594, 16595, 16597, 16598, 16603, 16604, 16605, 16606, 16608, 16609, 16610, 16611, 3371, 3372, 3373, 3374, 3375, 3376, 3377, 3378, 3379, 3380, 6548, 6549, 6550, 6551, 6552, 6553, 6554, 6555, 6556, 6557, 7393, 7394, 7395, 7396, 50010, 3328, 5589, 5586, 5585, 5587, 5588, 5584, 50014, 92891, 92892, 92893, 92894, 92895, 92896, 92897, 92898, 92899, 92900, 92901, 92902, 92903, 92904, 92905, 92906, 92907, 92908, 92942, 92943, 92944, 92945, 92946, 92884, 92910, 92909, 92912, 92911, 92913, 92914, 23281, 391, 280, 281, 282, 283, 284, 285, 286, 287, 200615, 32343, 50012, 4256, 288, 309, 311, 310, 312, 314, 366, 386, 436, 22788, 42752, 42753, 42754, 42755, 42756, 42757, 42758, 42759, 42760, 42761, 42762, 42764, 42765, 42766, 42767, 42768, 42769, 42770, 42771, 42772, 42773, 42774, 42775, 42776, 42777, 42778, 42779, 42780, 42781, 42782, 42783, 42784, 42785, 42868, 42884, 42885, 42886, 42891, 42892, 42895, 42896, 42897, 42898, 6504, 42916, 42917, 42918, 43175, 43180, 43236, 6505, 16472, 26901, 32075, 119054, 202720, 42750, 42914, 42915, 35867, 43121, 43122, 43123, 43200, 46167, 46168, 46169, 46170, 32063, 32060, 569, 46240, 46243, 570, 32058, 32061, 32062, 32064, 42763, 43044, 42749, 6491, 45610, 54765, 54807, 54193, 54766, 54192, 54120, 54163, 54190, 54145, 54186, 54768, 14323, 54188, 54805, 53897, 53898, 32054, 17631, 54164, 53857, 53863, 53864, 53865, 53866, 53868, 53869, 53875, 53895, 53896, 54751, 54752, 54753, 54755, 54756, 54757, 54758, 68491, 68500, 68931, 68963, 69677, 69679, 16990, 43173, 2724, 2723, 43177, 52956, 43178, 52958, 43204, 43205, 43210, 43221, 15540, 21699, 720, 30449, 6867, 6506, 32055, 33790, 4200, 47640, 34182, 15576, 15577, 15702, 15703, 15705, 34141, 32101, 15938, 92983, 45246, 565, 32859, 32911, 32325, 32327, 32789, 92885, 3956, 16571, 34142, 3957, 3955, 2725, 133921, 11215, 23279, 11271, 16599, 16596, 33316, 32069, 20428, 32066, 13981, 23419, 42360, 42361, 42363, 42386, 42387, 42679, 42362, 39104, 32912, 32915, 200150, 200151, 200152, 6503, 20943, 20945, 20946, 18601, 18600, 18596, 8505, 18580, 24051, 12159, 12268, 12269, 17315, 52011, 52013, 52014, 52015, 52016, 52017, 52018, 52020, 96619, 96594, 88164, 209102, 209103, 209104, 209105, 209106, 209107, 209108, 209109, 209110, 209111, 96270, 97112, 49580, 49649, 49584, 49588, 34033, 120602, 34040, 42155, 42156, 48316, 48317, 48318, 48319, 48320, 48321, 48322, 88223, 201235, 201236, 201237, 201239, 201241, 202721, 202722, 202966, 202968, 204942, 204943, 42157, 48323, 48324, 48325, 48326, 88224, 201242, 202723, 202967, 204944, 42153, 48327, 48334, 48335, 48336, 48337, 88213, 88214, 202726, 202727, 202958, 202959, 202960, 202961, 204945, 204946, 42154, 48338, 48339, 48340, 48341, 48342, 88215, 88216, 202730, 202731, 202962, 202963, 202964, 202965, 204947, 204948, 86929, 85224, 202594, 202595, 133920, 133919, 133918, 85094, 85123, 85124, 85125, 85126, 85127, 85128, 85129, 85135, 88227, 88165, 88166, 202597, 202598, 85214, 81016, 84753, 85217, 86928, 84987, 84988, 85159, 85160, 85161, 85162, 85171, 85173, 85174, 85200, 85238, 85117, 85120, 65523, 66479, 203394, 203420, 31901, 85216, 137701, 137702, 101236, 133649, 88752, 88753, 88754, 88755, 88756, 88757, 88758, 88759, 88760, 88761, 88762, 88763, 88764, 88765, 88766, 88767, 88768, 88769, 88777, 88778, 200915, 200916, 200929, 200950, 201040, 201187, 201463, 201533, 201624, 88793, 88794, 88795, 88796, 88797, 88798, 88799, 88800, 88801, 88802, 88803, 88804, 88805, 88806, 133917, 202605, 202606, 246900, 246901, 246902, 246903, 246904, 246905, 246915, 207194, 207195, 207196, 202846, 5200000, 5300000, 5300001, 5300002, 5300003);'
    ],
    [
        'creature_formations', # DONE
        0,
        'point_2',
        '`memberGUID`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `creature_formations` WHERE `leaderGUID` IN (88777, 92903, 246905, 246915, 5300002);'
    ],
    [
        'creature_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `Reference`, `GroupId`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `creature_loot_template` WHERE `Entry`=10184;\nDELETE FROM `creature_loot_template` WHERE `Entry`=31311 AND `Reference`=34349;\nDELETE FROM `creature_loot_template` WHERE `Item` IN (17008, 17413, 17414, 17682, 17683, 18600, 18665, 18705, 18987, 21103, 21104, 21105, 21108, 21110, 21877, 27859, 27860, 31952, 49205);\nDELETE FROM `creature_loot_template` WHERE `Item` IN (40752, 40753, 45624, 47241) AND `Entry` IN (15928, 15931, 15932, 15936, 15952, 15953, 15954, 15956, 15989, 15990, 16011, 16028, 16060, 16061, 28860, 29249, 29268, 29278, 29324, 29373, 29417, 29448, 29615, 29701, 29718, 29932, 29940, 29955, 29991, 30061, 30397, 30398, 30510, 30529, 30530, 30532, 30540, 30748, 30774, 30788, 30807, 30810, 31125, 31211, 31212, 31215, 31311, 31349, 31350, 31360, 31362, 31367, 31368, 31370, 31381, 31384, 31386, 31456, 31463, 31464, 31465, 31469, 31506, 31507, 31508, 31509, 31510, 31511, 31512, 31533, 31536, 31537, 31538, 31558, 31559, 31560, 31610, 31611, 31612, 31656, 31673, 31679, 31722, 32313, 32857, 32867, 32927, 33118, 33186, 33190, 33271, 33288, 33293, 33449, 33515, 33692, 33693, 33694, 33724, 33885, 33955, 33993, 33994, 34175, 35013, 35360, 35490, 36538);\nDELETE FROM `creature_loot_template` WHERE `Entry` IN (69, 299) AND `Item` IN (750, 50432);'
    ],
    [
        'creature_onkill_reputation', # DONE
        1,
        'creature_id',
        '`creature_id`, `Patch`',
        'DELETE FROM `creature_onkill_reputation` WHERE `creature_id` IN (1783, 1784, 1785, 1787, 1788, 1789, 1791, 1793, 1794, 1795, 1796, 1802, 1804, 1805, 1847, 1852, 2496, 2625, 2636, 2778, 4472, 4474, 4475, 4624, 4638, 4639, 4640, 4641, 4642, 4643, 4644, 4645, 4646, 4647, 4648, 4649, 4651, 4652, 4653, 4661, 4662, 5601, 5602, 6068, 7153, 7154, 7155, 7156, 7157, 7158, 7438, 7439, 7440, 7441, 7442, 8123, 8523, 8524, 8525, 8526, 8527, 8528, 8529, 8530, 8531, 8532, 8534, 8535, 8538, 8539, 8540, 8541, 8542, 8543, 8544, 8545, 8546, 8547, 8548, 8550, 8551, 8553, 8555, 8556, 8557, 8558, 9462, 9464, 10199, 10381, 10382, 10384, 10385, 10390, 10391, 10398, 10399, 10400, 10405, 10406, 10407, 10408, 10409, 10412, 10413, 10414, 10416, 10417, 10432, 10433, 10435, 10436, 10437, 10438, 10440, 10463, 10464, 10469, 10470, 10471, 10476, 10477, 10478, 10480, 10481, 10482, 10485, 10486, 10487, 10488, 10489, 10491, 10495, 10498, 10499, 10500, 10502, 10503, 10504, 10505, 10507, 10508, 10558, 10580, 10698, 10738, 10801, 10809, 10816, 10821, 10825, 10826, 10827, 10901, 10916, 11082, 11257, 11261, 11338, 11339, 11340, 11350, 11351, 11352, 11353, 11356, 11359, 11361, 11365, 11370, 11371, 11372, 11373, 11374, 11551, 11582, 11622, 11803, 11804, 11830, 11831, 11873, 11880, 11881, 11882, 11883, 12262, 12263, 14342, 14479, 14532, 14750, 14821, 14825, 14861, 14880, 14882, 14883, 15043, 15111, 15168, 15200, 15201, 15202, 15204, 15205, 15206, 15207, 15208, 15209, 15211, 15212, 15213, 15220, 15229, 15230, 15235, 15236, 15240, 15249, 15262, 15264, 15277, 15305, 15307, 15308, 15318, 15319, 15320, 15323, 15324, 15325, 15327, 15333, 15335, 15336, 15338, 15339, 15340, 15348, 15355, 15369, 15370, 15461, 15462, 15537, 15538, 15541, 15542, 15623, 15727, 16184);'
    ],
    [
        'creature_questender', # NOT DONE
        0,
        'quest',
        '`id`, `quest`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `creature_questender` WHERE `id` IN (20735, 31439);\nDELETE FROM `creature_questender` WHERE `quest` IN (550, 1661, 3631, 4487, 4488, 4489, 4490, 7028, 7029, 7041, 7044, 7064, 7065, 7066, 7067, 7068, 7070, 7441, 7481, 7482, 7490, 7491, 7492, 7494, 7495, 7496, 7562, 7638, 7670, 8194, 8922, 8923, 10955, 11130, 11172, 11211, 11214, 11215, 11481, 11482, 11497, 11498, 11880, 13830, 13832, 13833, 13834, 13836, 13861, 13862, 13863, 13864, 14016, 14100, 14111);'
    ],
    [
        'creature_queststarter', # NOT DONE
        0,
        'quest',
        '`id`, `quest`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `creature_queststarter` WHERE `id` IN (20735, 31439);\nDELETE FROM `creature_queststarter` WHERE `quest` IN (550, 1661, 3631, 4487, 4488, 4489, 4490, 7028, 7029, 7041, 7044, 7064, 7065, 7066, 7067, 7068, 7070, 7441, 7481, 7482, 7491, 7492, 7494, 7496, 7562, 7638, 7670, 8194, 8922, 8923, 10955, 11130, 11172, 11211, 11214, 11215, 11481, 11482, 11497, 11498, 11880, 13830, 13832, 13833, 13834, 13836, 13861, 13862, 13863, 13864, 14016, 14100, 14111);'
    ],
    [
        'creature_template', # DONE
        1,
        'difficulty_entry_3',
        '`entry`, `Patch`',
        'DELETE FROM `creature_template` WHERE `entry` IN (38, 68, 69, 103, 299, 352, 466, 523, 594, 596, 619, 706, 853, 866, 931, 946, 1063, 1064, 1387, 1505, 1506, 1507, 1571, 1572, 1573, 1642, 1667, 1688, 1736, 1737, 1739, 1741, 1747, 1748, 1756, 1852, 1892, 1893, 1896, 1976, 1986, 1994, 2106, 2226, 2299, 2389, 2409, 2425, 2432, 2784, 2835, 2851, 2858, 2859, 2861, 2941, 2952, 2953, 2954, 2966, 2995, 3057, 3083, 3084, 3101, 3102, 3183, 3210, 3211, 3213, 3214, 3296, 3305, 3310, 3529, 3531, 3533, 3571, 3615, 3630, 3631, 3632, 3633, 3634, 3638, 3641, 3838, 3841, 4262, 4267, 4280, 4281, 4282, 4283, 4284, 4285, 4312, 4314, 4317, 4319, 4321, 4407, 4423, 4551, 4624, 4788, 4789, 4802, 4803, 4844, 4845, 4846, 4851, 4856, 4872, 4949, 5224, 5225, 5235, 5243, 5261, 5263, 5269, 5546, 5547, 5595, 5624, 5645, 5646, 5647, 5952, 6026, 6132, 6208, 6210, 6213, 6231, 6706, 6726, 7370, 7823, 7824, 7865, 7872, 7873, 7874, 7937, 7939, 7975, 7980, 7999, 8018, 8019, 8020, 8147, 8155, 8383, 8554, 8609, 8610, 9043, 9044, 9460, 10181, 10184, 10378, 10508, 10540, 10583, 10897, 11138, 11139, 11190, 11194, 11262, 11440, 11442, 11443, 11777, 11781, 11782, 11785, 11786, 11787, 11788, 11798, 11800, 11822, 11832, 11899, 11900, 11901, 12129, 12160, 12338, 12377, 12378, 12379, 12380, 12397, 12577, 12578, 12596, 12616, 12617, 12636, 12740, 12865, 13177, 13839, 14304, 14363, 14365, 14367, 14375, 14376, 14377, 14378, 14379, 14380, 14423, 14438, 14439, 14440, 14441, 14730, 15177, 15178, 15184, 15350, 15351, 16096, 16222, 16227, 16378, 16733, 16802, 17468, 18978, 20672, 20674, 24456, 24818, 24819, 24841, 24842, 24996, 24997, 24998, 25007, 25021, 25022, 25023, 25024, 25079, 25080, 25081, 25083, 29016, 29019, 29088, 29144, 29152, 29154, 29712, 31439, 36224, 36225, 36226, 36273);'
    ],
    [
        'creature_template_addon', # DONE
        1,
        'entry',
        '`entry`, `Patch`',
        'DELETE FROM `creature_template_addon` WHERE `entry` IN (69, 299);'
    ],
    [
        'creature_template_model', # DONE
        1,
        'Idx',
        '`CreatureID`, `Idx`, `Patch`',
        'DELETE FROM `creature_template_model` WHERE `CreatureID` IN (69, 299);'
    ],
    [
        'creature_text', # DONE
        0,
        'comment',
        '`CreatureID`, `GroupID`, `ID`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `creature_text` WHERE `CreatureID`=12397;'
    ],
    [
        'disables', # DONE
        0,
        'comment',
        '`sourceType`, `entry`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `disables` WHERE `sourceType`=1 AND `entry` IN (550, 3631, 4487, 4488, 4489, 4490, 6145, 6521, 6522);\nDELETE FROM `disables` WHERE `sourceType`=2 AND `entry` IN (269, 309, 349, 429, 469, 509, 531, 532, 533, 534, 540, 542, 543, 544, 545, 546, 547, 548, 550, 552, 553, 554, 555, 556, 557, 558, 560, 564, 565, 568, 574, 575, 576, 578, 580, 585, 595, 599, 600, 601, 602, 603, 604, 608, 615, 616, 619, 624, 631, 632, 649, 650, 658, 668, 724);\nDELETE FROM `disables` WHERE `sourceType`=3 AND `entry` IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 30, 32);\nDELETE FROM `disables` WHERE `sourceType`=5 AND `entry` IN (1, 2, 3, 4, 5, 6, 7);\nDELETE FROM `disables` WHERE `sourceType`=9 AND `entry` IN (1, 2, 3, 4, 5, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 19, 20, 21, 23, 24, 26, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 70, 71, 76, 77, 90);'
    ],
    [
        'disenchant_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'dungeon_access_requirements', # DONE
        0,
        'comment',
        '`dungeon_access_id`, `requirement_type`, `requirement_id`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `dungeon_access_requirements` WHERE `dungeon_access_id` IN (29, 32, 64);'
    ],
    [
        'dungeon_access_template', # DONE
        0,
        'comment',
        '`id`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `dungeon_access_template` WHERE `map_id` IN (249, 533);'
    ],
    [
        'fishing_loot_template', # NOT DONE
        0,
        'Comment', '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `fishing_loot_template` WHERE `Reference`=11150;'
    ],
    [
        'gameobject', # DONE
        0,
        'Comment',
        '`guid`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `gameobject` WHERE `guid` IN (6928, 50675, 50676, 50677, 50678, 50679, 50680, 50681, 50682, 50683, 50684, 50685, 50686, 50687, 50688, 50689, 50690, 50691, 50692, 151256, 151257, 151258, 151259, 151260, 151261, 151262, 151263, 151264, 151265, 151266, 151267, 151268, 246083, 246084, 246085, 246086);\nDELETE FROM `gameobject` WHERE `id` IN (164725, 175528, 175529, 175530, 175531, 175532, 175533, 176146, 176147, 176148, 176996, 178824, 178825, 178826, 178827, 178828, 178829, 178831, 178832, 178833, 178834, 178844, 178845, 178884, 179554, 179555, 179584, 179585, 179595, 179596, 179827, 179844, 179846, 179879, 179895, 179896, 179913, 180448, 180451, 180665, 180666, 180667, 180717, 180718, 180913, 181075, 181076, 181077, 181078, 181079, 181080, 181081, 181082, 181130, 181131, 181236, 181257, 181310, 181476, 181603, 181617, 181618, 181619, 182560, 183435, 184463, 184503, 185321, 185322, 185433, 185491, 185492, 185493, 185494, 185495, 185503, 185504, 185518, 185550, 186230, 186231, 186232, 186233, 186251, 186426, 186730, 186731, 187056, 187290, 187291, 187292, 187294, 187295, 187296, 187299, 187329, 187334, 187337, 187365, 187390, 190683, 190684, 190697, 190698, 190699, 190704, 190710, 190711, 190712, 193981, 194213, 194237, 194498, 195141, 195142, 195213, 195214, 195218, 195467, 195498, 195528, 195529, 195530, 195554, 195555, 195556, 195557, 195558, 195559, 195560, 195561, 195562, 195603, 195604, 195605, 195606, 195607, 195608, 195609, 195610, 195611, 195612, 195613, 195614, 195615, 195616, 195617, 195618, 195619, 195620, 195624, 195625, 195626, 195627, 195628, 195695, 202184, 202277, 202278, 202713);'
    ],
    [
        'gameobject_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `gameobject_loot_template` WHERE `Item` IN (18646, 19803, 19805, 19806, 19807, 19808, 21877, 27859, 27860, 50289);\nDELETE FROM `gameobject_loot_template` WHERE `Item` IN (40752, 40753, 45624, 47241) AND `Entry` IN (24524, 24589, 25192, 25193, 26094, 26097, 26260, 26929, 26946, 26955, 26956, 26959, 26960, 26961, 26962, 26963, 26967, 26974, 27030, 27061, 27068, 27073, 27074, 27078, 27079, 27080, 27081, 27085, 27086, 27414, 27416, 27417);'
    ],
    [
        'gameobject_questender', # NOT DONE
        0,
        'quest',
        '`id`, `quest`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'gameobject_queststarter', # NOT DONE
        0,
        'quest',
        '`id`, `quest`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'gameobject_template', # DONE
        1,
        'entry',
        '`entry`, `Patch`',
        'DELETE FROM `gameobject_template` WHERE `entry`=176310;'
    ],
    [
        'gameobject_template_addon', # DONE
        1,
        'entry',
        '`entry`, `Patch`',
        'DELETE FROM `gameobject_template_addon` WHERE `entry` IN (176146, 176147, 176148, 176996);'
    ],
    [
        'gossip_menu_option', # NOT DONE
        0,
        'VerifiedBuild',
        '`MenuID`, `OptionID`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `gossip_menu_option` WHERE (`MenuID`=421 AND `OptionID`=8) OR (`MenuID`=435 AND `OptionID`=12) OR (`MenuID`=751 AND `OptionID`=7) OR (`MenuID`=1942 AND `OptionID`=8) OR (`MenuID`=1951 AND `OptionID` IN (11, 14)) OR (`MenuID`=2121 AND `OptionID`=10) OR (`MenuID`=2168 AND `OptionID`=8) OR (`MenuID`=2351 AND `OptionID`=6) OR (`MenuID`=2352 AND `OptionID`=11) OR (`MenuID`=3284 AND `OptionID`=8) OR (`MenuID`=3330 AND `OptionID`=7) OR (`MenuID`=3355 AND `OptionID`=8) OR (`MenuID`=3532 AND `OptionID`=8) OR (`MenuID`=3558 AND `OptionID`=8) OR (`MenuID`=3572 AND `OptionID`=6) OR (`MenuID`=7667 AND `OptionID`=8) OR (`MenuID`=7788 AND `OptionID`=7) OR (`MenuID`=8138 AND `OptionID`=8) OR (`MenuID`=8205 AND `OptionID`=8) OR (`MenuID`=10056 AND `OptionID`=11) OR (`MenuID`=10078 AND `OptionID`=8) OR (`MenuID`=10265 AND `OptionID`=11) OR (`MenuID`=10767 AND `OptionID`=8) OR (`MenuID`=10769 AND `OptionID`=2);\nDELETE FROM `gossip_menu_option` WHERE (`MenuID`=401 AND `OptionID`=6) OR (`MenuID`=1949 AND `OptionID`=7) OR (`MenuID`=2144 AND `OptionID`=7) OR (`MenuID`=3354 AND `OptionID`=1) OR (`MenuID`=3519 AND `OptionID`=6) OR (`MenuID`=10768 AND `OptionID`=1);'
    ],
    [
        'item_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `item_loot_template` WHERE `Item` IN (40752, 40753, 45624, 47241) AND `Entry` IN (43346, 43347, 45875, 45878);\nDELETE FROM `item_loot_template` WHERE `Item`=49426 AND `Entry` IN (54516, 54535, 54536);'
    ],
    [
        'item_template', # NOT DONE
        1,
        'entry',
        '`entry`, `Patch`',
        'DELETE FROM `item_template` WHERE `entry` IN (1132, 2411, 2414, 5655, 5656, 5665, 5668, 5864, 5872, 5873, 8563, 8588, 8591, 8592, 8595, 8629, 8631, 8632, 13086, 13321, 13322, 13331, 13332, 13333, 13334, 13335, 15277, 15290, 17008, 18241, 18242, 18243, 18244, 18766, 18767, 18772, 18773, 18774, 18776, 18777, 18778, 18785, 18786, 18787, 18788, 18789, 18790, 18791, 18793, 18794, 18795, 18796, 18797, 18798, 18902, 19029, 19030, 19872, 19902, 21218, 21321, 21323, 21324, 25470, 25471, 25472, 25473, 25474, 25475, 25476, 25477, 25527, 25528, 25529, 25531, 25532, 25533, 28481, 28915, 28927, 28936, 29102, 29103, 29104, 29105, 29220, 29221, 29222, 29223, 29224, 29227, 29228, 29229, 29230, 29231, 29465, 29466, 29467, 29468, 29469, 29470, 29471, 29472, 29743, 29744, 29745, 29746, 29747, 30480, 30622, 30623, 30633, 30634, 30635, 30637, 31829, 31830, 31831, 31832, 31833, 31834, 31835, 31836, 32768, 33976, 33977, 34129, 35513, 35906, 40775, 43956, 43958, 43959, 43961, 44077, 44080, 44083, 44086, 44225, 44226, 44230, 44231, 44234, 44235, 46099, 46100, 46308, 47100, 47101);'
    ],
    [
        'mail_level_reward', # DONE
        1,
        'senderEntry',
        '`level`, `raceMask`, `Patch`',
        'DELETE FROM `mail_level_reward`;'
    ],
    [
        'mail_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'milling_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'npc_text', # DONE
        1,
        'ID',
        '`ID`, `Patch`',
        'DELETE FROM `npc_text` WHERE `ID`=5480;'
    ],
    [
        'npc_trainer', # DONE
        0,
        'ReqSpell',
        '`ID`, `SpellID`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `npc_trainer` WHERE `SpellID` IN (1066, 1710, 10847, 13820, 18249, 21562, 21564, 21849, 21850, 23028, 23161, 23214, 25286, 25288, 25289, 25290, 25291, 25292, 25294, 25295, 25296, 25297, 25298, 25299, 25300, 25302, 25304, 25306, 25307, 25309, 25311, 25314, 25315, 25316, 25345, 25357, 25361, 25392, 25782, 25894, 25898, 25899, 25916, 25918, 26991, 27090, 27127, 27683, 28609, 28610, 28612, 29228, 31016, 31018, 31709, 33388, 33391, 33717, 33950, 34090, 34767, 34768, 36936, 39374, 53042, 54083, 63742, 63743, 63746, 63750, 64725, 64726, 64727, 64728, 66842, 66843, 66844);\nDELETE FROM `npc_trainer` WHERE ((`ReqLevel` > 60 AND `ReqLevel` <= 70) OR (`ReqSkillRank` > 300 AND `ReqSkillRank` <= 375)) AND `SpellID` NOT IN (1710, 10847, 13820, 18249, 21562, 21564, 21849, 21850, 23028, 23161, 23214, 25782, 25894, 25898, 25899, 25916, 25918, 27681, 33388, 33391, 33950, 34090, 34767, 34768, 36936, 53042, 54083, 63742, 63743, 63746, 63750, 64725, 64726, 64727, 64728, 66842, 66843, 66844);\nDELETE FROM `npc_trainer` WHERE ((`ReqLevel` > 70 OR `ReqSkillRank` > 375) AND `SpellID` NOT IN (1710, 10847, 13820, 18249, 21562, 21564, 21849, 21850, 23028, 23161, 23214, 25782, 25894, 25898, 25899, 25916, 25918, 27681, 33388, 33391, 33950, 34090, 34767, 34768, 36936, 53042, 54083, 63742, 63743, 63746, 63750, 64725, 64726, 64727, 64728, 66842, 66843, 66844));'
    ],
    [
        'npc_vendor', # DONE
        0,
        'VerifiedBuild',
        '`entry`, `item`, `ExtendedCost`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `npc_vendor` WHERE `item` IN (16083, 16084, 17020, 17021, 17026, 17028, 17029, 21177, 22147, 22148, 27855, 27856, 27857, 27859, 28053, 28060, 28399, 29267, 29268, 29269, 29270, 29272, 29273, 29274, 29275, 29367, 29368, 29370, 29373, 29374, 29375, 29379, 29381, 29383, 29384, 29386, 29387, 29389, 30761, 30762, 30763, 30764, 30766, 30767, 30768, 30769, 30770, 30772, 30773, 30774, 30776, 30778, 30779, 30780, 32083, 32084, 32085, 32086, 32087, 32088, 32089, 32090, 33192, 33207, 33279, 33280, 33287, 33291, 33296, 33304, 33324, 33325, 33331, 33333, 33334, 33386, 33443, 33444, 33445, 33449, 33452, 33454, 33484, 33501, 33502, 33503, 33504, 33505, 33506, 33507, 33510, 33512, 33513, 33514, 33515, 33516, 33517, 33518, 33519, 33520, 33522, 33523, 33524, 33527, 33528, 33529, 33530, 33531, 33532, 33534, 33535, 33536, 33537, 33538, 33539, 33540, 33552, 33557, 33559, 33566, 33578, 33579, 33580, 33582, 33583, 33584, 33585, 33586, 33587, 33588, 33589, 33593, 33810, 33832, 33965, 33970, 33972, 33974, 34049, 34050, 34162, 34163, 34581, 34582, 35321, 35324, 35326, 35947, 35948, 35949, 35950, 35952, 35953, 35954, 37201, 37915, 38327, 38328, 40411, 44605, 44614, 44615, 45057, 45335, 45336, 45337, 45338, 45339, 45340, 45341, 45342, 45343, 45344, 45345, 45346, 45347, 45348, 45349, 45351, 45352, 45353, 45354, 45355, 45356, 45357, 45358, 45359, 45360, 45361, 45362, 45363, 45364, 45365, 45367, 45368, 45369, 45370, 45371, 45372, 45373, 45374, 45375, 45376, 45377, 45379, 45380, 45381, 45382, 45383, 45384, 45385, 45386, 45387, 45388, 45389, 45390, 45391, 45392, 45393, 45394, 45395, 45396, 45397, 45398, 45399, 45400, 45401, 45402, 45403, 45404, 45405, 45406, 45408, 45409, 45410, 45411, 45412, 45413, 45414, 45415, 45416, 45417, 45419, 45420, 45421, 45422, 45424, 45425, 45426, 45427, 45428, 45429, 45430, 45431, 45432, 45433, 45689, 45690, 45691, 45774, 45819, 45820, 45821, 45822, 45823, 45824, 45825, 45826, 45827, 45828, 45829, 45830, 45831, 45833, 45834, 45835, 45836, 45837, 45838, 45839, 45840, 45841, 45842, 45843, 45844, 45845, 45846, 45847, 45848, 46057, 46058, 46059, 46060, 46061, 46062, 46063, 46064, 46065, 46066, 46071, 46072, 46073, 46074, 46075, 46076, 46077, 46078, 46079, 46080, 46081, 46082, 46083, 46084, 46085, 46086, 46087, 46088, 46111, 46113, 46115, 46116, 46117, 46118, 46119, 46120, 46121, 46122, 46123, 46124, 46125, 46126, 46127, 46129, 46130, 46131, 46132, 46133, 46134, 46135, 46136, 46137, 46139, 46140, 46141, 46142, 46143, 46144, 46145, 46146, 46148, 46149, 46150, 46151, 46152, 46153, 46154, 46155, 46156, 46157, 46158, 46159, 46160, 46161, 46162, 46163, 46164, 46165, 46166, 46167, 46168, 46169, 46170, 46172, 46173, 46174, 46175, 46176, 46177, 46178, 46179, 46180, 46181, 46182, 46183, 46184, 46185, 46186, 46187, 46188, 46189, 46190, 46191, 46192, 46193, 46194, 46195, 46196, 46197, 46198, 46199, 46200, 46201, 46202, 46203, 46204, 46205, 46206, 46207, 46208, 46209, 46210, 46211, 46212, 46313, 46349, 47729, 47730, 47731, 47732, 47733, 47748, 47749, 47750, 47751, 47752, 47773, 47774, 47775, 47776, 47777, 47783, 47784, 47785, 47786, 47787, 47798, 47799, 47800, 47801, 47802, 47914, 47936, 47980, 47981, 47982, 48067, 48068, 48069, 48070, 48071, 48072, 48073, 48074, 48075, 48076, 48097, 48098, 48099, 48100, 48101, 48102, 48129, 48130, 48131, 48132, 48153, 48154, 48155, 48156, 48157, 48158, 48159, 48160, 48161, 48162, 48183, 48184, 48185, 48186, 48187, 48188, 48189, 48190, 48191, 48192, 48213, 48214, 48215, 48216, 48217, 48218, 48219, 48220, 48221, 48222, 48243, 48244, 48245, 48246, 48247, 48250, 48251, 48252, 48253, 48254, 48275, 48276, 48277, 48278, 48279, 48280, 48281, 48282, 48283, 48284, 48295, 48296, 48297, 48298, 48299, 48310, 48312, 48313, 48314, 48315, 48336, 48337, 48338, 48339, 48340, 48341, 48342, 48343, 48344, 48345, 48366, 48367, 48368, 48369, 48370, 48371, 48372, 48373, 48374, 48375, 48386, 48387, 48388, 48389, 48390, 48429, 48436, 48445, 48448, 48449, 48456, 48457, 48458, 48459, 48460, 48472, 48474, 48476, 48478, 48480, 48501, 48502, 48503, 48504, 48505, 48529, 48531, 48533, 48535, 48537, 48558, 48559, 48560, 48561, 48562, 48564, 48566, 48568, 48572, 48574, 48595, 48596, 48597, 48598, 48599, 48602, 48603, 48604, 48605, 48606, 48627, 48628, 48629, 48630, 48631, 48632, 48633, 48634, 48635, 48636, 48652, 48653, 48654, 48655, 48656, 48677, 48683, 48685, 48687, 48689, 48691, 48718, 48954, 48955, 48956, 48957, 48974, 48975, 48976, 48977, 48978, 48979, 48980, 48981, 48982, 48983, 48987, 48988, 48990, 48991, 48992, 48993, 48994, 48997, 48998, 48999, 49000, 49177, 50078, 50079, 50080, 50081, 50082, 50087, 50088, 50089, 50090, 50094, 50095, 50096, 50097, 50098, 50105, 50106, 50107, 50108, 50109, 50113, 50114, 50115, 50116, 50117, 50118, 50240, 50241, 50242, 50243, 50244, 50275, 50276, 50277, 50278, 50279, 50324, 50325, 50326, 50327, 50328, 50391, 50392, 50393, 50394, 50396, 50765, 50766, 50767, 50768, 50769, 50819, 50820, 50821, 50822, 50823, 50824, 50825, 50826, 50827, 50828, 50830, 50831, 50832, 50833, 50834, 50835, 50836, 50837, 50838, 50839, 50841, 50842, 50843, 50844, 50845, 50846, 50847, 50848, 50849, 50850, 50853, 50854, 50855, 50856, 50857, 50860, 50861, 50862, 50863, 50864, 50865, 50866, 50867, 50868, 50869, 51125, 51126, 51127, 51128, 51129, 51130, 51131, 51132, 51133, 51134, 51135, 51136, 51137, 51138, 51139, 51140, 51141, 51142, 51143, 51144, 51145, 51146, 51147, 51148, 51149, 51150, 51151, 51152, 51153, 51154, 51155, 51156, 51157, 51158, 51159, 51160, 51161, 51162, 51163, 51164, 51165, 51166, 51167, 51168, 51169, 51170, 51171, 51172, 51173, 51174, 51175, 51176, 51177, 51178, 51179, 51180, 51181, 51182, 51183, 51184, 51185, 51186, 51187, 51188, 51189, 51190, 51191, 51192, 51193, 51194, 51195, 51196, 51197, 51198, 51199, 51200, 51201, 51202, 51203, 51204, 51205, 51206, 51207, 51208, 51209, 51210, 51211, 51212, 51213, 51214, 51215, 51216, 51217, 51218, 51219, 51220, 51221, 51222, 51223, 51224, 51225, 51226, 51227, 51228, 51229, 51230, 51231, 51232, 51233, 51234, 51235, 51236, 51237, 51238, 51239, 51240, 51241, 51242, 51243, 51244, 51245, 51246, 51247, 51248, 51249, 51250, 51251, 51252, 51253, 51254, 51255, 51256, 51257, 51258, 51259, 51260, 51261, 51262, 51263, 51264, 51265, 51266, 51267, 51268, 51269, 51270, 51271, 51272, 51273, 51274, 51275, 51276, 51277, 51278, 51279, 51280, 51281, 51282, 51283, 51284, 51285, 51286, 51287, 51288, 51289, 51290, 51291, 51292, 51293, 51294, 51295, 51296, 51297, 51298, 51299, 51300, 51301, 51302, 51303, 51304, 51305, 51306, 51307, 51308, 51309, 51310, 51311, 51312, 51313, 51314, 51557, 51558, 51559, 51560);\nDELETE FROM `npc_vendor` WHERE `entry`=32216 AND `item` IN (25470, 25471, 25472, 25473, 25474, 25475, 25476, 25477, 25527, 25528, 25529, 25531, 25532, 25533);\nDELETE FROM `npc_vendor` WHERE `entry` IN (39172, 39173);'
    ],
    [
        'pickpocketing_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `pickpocketing_loot_template` WHERE `Item` IN (21877, 27859);'
    ],
    [
        'player_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'player_xp_for_level', # DONE
        1,
        'Level',
        '`Level`, `Patch`',
        'DELETE FROM `player_xp_for_level` WHERE `Level` BETWEEN 11 AND 69;'
    ],
    [
        'pool_creature', # NOT DONE
        0,
        'description',
        '`guid`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `pool_creature` WHERE `pool_entry`=60003;'
    ],
    [
        'pool_quest', # NOT DONE
        0,
        'description',
        '`entry`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `pool_quest` WHERE `pool_entry` IN (5676, 5678, 87000);'
    ],
    [
        'pool_template', # NOT DONE
        0,
        'description',
        '`entry`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `pool_template` WHERE `entry` IN (5678, 60003, 87000);'
    ],
    [
        'prospecting_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'quest_offer_reward', # NOT DONE
        1,
        'ID',
        '`ID`, `Patch`',
        'DELETE FROM `quest_offer_reward` WHERE `ID`=33;'
    ],
    [
        'quest_request_items', # NOT DONE
        1,
        'ID',
        '`ID`, `Patch`',
        'DELETE FROM `quest_request_items` WHERE `ID`=33;'
    ],
    [
        'quest_template', # NOT DONE
        1,
        'ID',
        '`ID`, `Patch`',
        'DELETE FROM `quest_template` WHERE `ID` IN (33, 6607, 6622, 6624, 13240, 13241, 13243, 13244, 13245, 13246, 13247, 13248, 13249, 13250, 13251, 13252, 13253, 13254, 13255, 13256, 14199, 24788, 24789, 24790);'
    ],
    [
        'reference_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `reference_loot_template` WHERE `Entry` BETWEEN 46000 AND 46009;\nDELETE FROM `reference_loot_template` WHERE `Entry`=34349 AND `Item` IN (45624, 47241);\nDELETE FROM `reference_loot_template` WHERE `Entry`=34000;\nDELETE FROM `reference_loot_template` WHERE `Item` IN (17413, 17414, 17682, 17683, 18600, 19803, 19805, 19806, 19807, 19808, 50289);'
    ],
    [
        'skinning_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'smart_scripts', # DONE
        0,
        'comment',
        '`entryorguid`, `source_type`, `id`, `link`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `smart_scripts` WHERE `entryorguid` IN (-246915, -246904, -209026, -209025, -209024, -209023, -209022, -209021, -209020, -209019, -96612, -96611, -96610, -96604, -96603, -96600, -96596, -96595, -88792, -88791, -88790, -88789, -88788, -88787, -88786, -88785, -88784, -88783, -88782, -88781, -88780, -88779, 1748);'
    ],
    [
        'spell_loot_template', # NOT DONE
        0,
        'Comment',
        '`Entry`, `Item`, `MinPatch`, `MaxPatch`',
        ''
    ],
    [
        'spell_script_names', # DONE
        2,
        '',
        '',
        'DELETE FROM `spell_script_names` WHERE `spell_id`=21056;'
    ],
    [
        'transports', # DONE
        1,
        'guid',
        '`guid`, `Patch`',
        'DELETE FROM `transports` WHERE `guid` IN (9, 10, 11, 12, 17, 20);'
    ],
    [
        'waypoint_data', # DONE
        0,
        'wpguid',
        '`id`, `point`, `MinPatch`, `MaxPatch`',
        'DELETE FROM `waypoint_data` WHERE `id` IN (5200000, 5300002);'
    ]
]

cwd = os.getcwd()
mysqlcnf = f'{cwd}/mysql.cnf'

os.system('cls' if os.name == 'nt' else 'clear')

file = open(mysqlcnf, 'w')
file.write(f'[client]\nhost="{mysql['host']}"\nport="{mysql['port']}"\nuser="{mysql['username']}"\npassword="{mysql['password']}"')
file.close()

def PrintHeader(string):
    print(f'{colorama.Fore.GREEN}{string}{colorama.Style.RESET_ALL}')

def PrintProgress(string):
    print(f'{colorama.Fore.YELLOW}{string}{colorama.Style.RESET_ALL}')

def PrintError(string):
    print(f'{colorama.Fore.RED}{string}{colorama.Style.RESET_ALL}')
    if os.path.exists(mysqlcnf):
        os.remove(mysqlcnf)
    if os.path.exists(f'{cwd}/export.sql'):
        os.remove(f'{cwd}/export.sql')
    exit()

class GitProgress(git.remote.RemoteProgress):
    def line_dropped(self, line):
        print(line)
    def update(self, *args):
        print(self._cur_line)

def ResetSource(path, branch):
    repo = git.Repo(path)
    repo.git.reset('--hard', f'origin/master')

def CloneSource(path, repo, branch):
    git.Repo.clone_from(url=repo, to_path=path, branch=branch, depth=1, progress=GitProgress())

def PullSource(path):
    repo = git.Repo(path)
    repo.remotes.origin.pull(progress=GitProgress())

def UpdateSource():
    PrintHeader('Updating source')
    if not os.path.exists(f'{cwd}/source'):
        try:
            CloneSource(f'{cwd}/source', 'git@github.com:noisiver/azerothcore', 'master')
        except Exception as e:
            print(e.stderr)
    else:
        try:
            ResetSource(f'{cwd}/source', 'master')
            PullSource(f'{cwd}/source')
        except Exception as e:
            print(e.stderr)
    PrintHeader('Finished updating source')

def DropTables():
    PrintHeader('Dropping tables')
    connect = pymysql.connect(host=mysql['host'], user=mysql['username'], password=mysql['password'], db=mysql['base'])
    cursor = connect.cursor()
    cursor.execute('SHOW TABLES;')
    tables = []
    for d in cursor.fetchall():
        tables.append(d[0])
    if len(tables) > 0:
        for table in tables:
            PrintProgress(f'Dropping {table}')
            cursor.execute(f'DROP TABLE {table};')
        connect.commit()
    cursor.close()
    connect.close()

    connect = pymysql.connect(host=mysql['host'], user=mysql['username'], password=mysql['password'], db=mysql['progression'])
    cursor = connect.cursor()
    cursor.execute('SHOW TABLES;')
    tables = []
    for d in cursor.fetchall():
        tables.append(d[0])
    if len(tables) > 0:
        for table in tables:
            PrintProgress(f'Dropping {table}')
            cursor.execute(f'DROP TABLE {table};')
        connect.commit()
    cursor.close()
    connect.close()
    PrintHeader('Finished dropping tables')

def ImportTables():
    PrintHeader('Importing tables')
    path = f'{cwd}/source/data/sql/base/db_world'
    if os.path.isdir(path):
        connect = pymysql.connect(host=mysql['host'], user=mysql['username'], password=mysql['password'], db=mysql['base'])
        cursor = connect.cursor()
        cursor.execute('SHOW TABLES;')
        tables = []
        for d in cursor.fetchall():
            tables.append(d[0])
        cursor.close()
        connect.close()

        files = sorted(os.listdir(path))
        for file in files:
            if os.path.isfile(f'{path}/{file}'):
                if file.endswith('.sql'):
                    short = file.replace('.sql', '')
                    if short in tables:
                        PrintProgress(f'Skipping {file}')
                    else:
                        PrintProgress(f'Importing {file}')
                        subprocess.run(f'{f'"{windows_paths['mysql']}/bin/mysql.exe"' if os.name == 'nt' else 'mysql'} --defaults-extra-file={mysqlcnf} {mysql['base']} < {path}/{file}', shell=True, check=True)
    PrintHeader('Finished importing tables')

def sha1sum(filename):
    with open(filename, 'rb', buffering=0) as f:
        return hashlib.file_digest(f, 'sha1').hexdigest()

def ImportUpdates():
    PrintHeader('Importing updates')
    path = f'{cwd}/source/data/sql/updates/db_world'
    if os.path.isdir(path):
        connect = pymysql.connect(host=mysql['host'], user=mysql['username'], password=mysql['password'], db=mysql['base'])
        cursor = connect.cursor()
        cursor.execute('SELECT name, hash FROM updates')
        updates = []
        for d in cursor.fetchall():
            updates.append([d[0], d[1]])

        files = sorted(os.listdir(path))
        for file in files:
            if os.path.isfile(f'{path}/{file}'):
                if file.endswith('.sql'):
                    sha = sha1sum(f'{path}/{file}').upper()
                    adv = [ file, sha ]

                    if adv in updates:
                        PrintProgress(f'Skipping {file}')
                    else:
                        PrintProgress(f'Importing {file}')
                        subprocess.run(f'{f'"{windows_paths['mysql']}/bin/mysql.exe"' if os.name == 'nt' else 'mysql'} --defaults-extra-file={mysqlcnf} {mysql['base']} < {path}/{file}', shell=True, check=True)
                        cursor.execute(f"DELETE FROM updates WHERE name='{file}';")
                        cursor.execute(f"INSERT INTO updates (name, hash) VALUES ('{file}', '{sha}');")
                        connect.commit()

        cursor.close()
        connect.close()
        PrintHeader('Finished importing updates')

def ImportData():
    PrintHeader('Importing base data')

    files = sorted(os.listdir(f'{cwd}/sql'))
    for file in files:
        if os.path.isfile(f'{cwd}/sql/{file}'):
            if file.endswith('.sql'):
                try:
                    PrintProgress(f'Importing {file}')
                    subprocess.run(f'{f'"{windows_paths['mysql']}/bin/mysql.exe"' if os.name == 'nt' else 'mysql'} --defaults-extra-file={mysqlcnf} {mysql['progression']} < {cwd}/sql/{file}', shell=True, check=True)
                except:
                    PrintError(f'Failed to import {file}')

    PrintHeader('Finished importing base data')

def GenerateProcedure(table, type, after, primary):
    return f'DELIMITER $$\nDROP PROCEDURE IF EXISTS AddColumn $$\nCREATE PROCEDURE AddColumn()\nBEGIN\n    IF NOT EXISTS((SELECT * FROM information_schema.COLUMNS WHERE TABLE_SCHEMA=DATABASE() AND COLUMN_NAME=\'{'MinPatch' if type == 0 else 'Patch'}\' AND TABLE_NAME=\'{table}\')) THEN\n        ALTER TABLE `{table}`\n            {f'ADD COLUMN `MinPatch` INT UNSIGNED NOT NULL DEFAULT \'0\' AFTER `{after}`,\n            ADD COLUMN `MaxPatch` INT UNSIGNED NOT NULL DEFAULT \'21\' AFTER `MinPatch`,\n' if type == 0 else f'ADD COLUMN `Patch` INT UNSIGNED NOT NULL DEFAULT \'0\' AFTER `{after}`,\n'}            DROP PRIMARY KEY,\n            ADD PRIMARY KEY ({primary}) USING BTREE;\n    END IF;\nEND $$\nCALL AddColumn()\n$$\nDELIMITER ;\nDROP PROCEDURE IF EXISTS AddColumn;'

def CreateBaseFiles():
    PrintHeader('Creating base files')

    if not os.path.isdir(f'{cwd}/export'):
        os.mkdir(f'{cwd}/export', 0o777)

    for table in tables:
        name = table[0]
        type = table[1]
        after = table[2]
        primary = table[3]
        deletes = table[4]

        try:
            if type == 2:
                if deletes:
                    data = deletes
            else:
                data = f'{GenerateProcedure(name, type, after, primary)}\n'
                if deletes:
                    data = f'{data}\n{deletes}'

            PrintProgress(f'Creating progression_{name}.sql')
            file = open(f'{cwd}/export/progression_{name}.sql', 'w')
            file.write(data)
            file.close()
        except:
            PrintError(f'Failed to create progression_{name}.sql')

    PrintHeader('Finished creating base files')

def ExportData():
    PrintHeader('Exporting data')

    for table in tables:
        name = table[0]

        try:
            PrintProgress(f'Exporting {name}')
            subprocess.run(f'{f'"{windows_paths['mysql']}/bin/mysqldump.exe"' if os.name == 'nt' else 'mysqldump'} --defaults-extra-file={mysqlcnf} --skip-add-drop-table --no-create-info --skip-comments --complete-insert {mysql['progression']} {name} > {cwd}/export.sql', shell=True, check=True)

            with open(f'{cwd}/export.sql', encoding='utf-8') as file:
                lines = file.readlines()

            with open(f'{cwd}/export.sql', 'w', encoding='utf-8') as file:
                for count, line in enumerate(lines):
                    if not line.startswith('/*') and not line.startswith('\n') and not line.startswith('LOCK') and not line.startswith('UNLOCK'):
                        file.write(line)

            with open(f'{cwd}/export.sql', 'r') as file:
                content = file.read()

            content = content.replace('VALUES ', 'VALUES\n').replace('),(', '),\n(').replace(',', ', ').replace(',  ', ', ').replace(', \n', ',\n')

            if len(content) > 0:
                with open(f'{cwd}/export/progression_{name}.sql', 'a') as file:
                    file.write(f'\n{content}')
        except:
            PrintError(f'Failed to export {name}')

    if os.path.exists(f'{cwd}/export.sql'):
        os.remove(f'{cwd}/export.sql')

    PrintHeader('Finished exporting data')

def ImportExportedData():
    PrintHeader('Importing generated data')

    files = sorted(os.listdir(f'{cwd}/export'))
    for file in files:
        if os.path.isfile(f'{cwd}/export/{file}'):
            if file.endswith('.sql'):
                try:
                    PrintProgress(f'Importing {file}')
                    subprocess.run(f'{f'"{windows_paths['mysql']}/bin/mysql.exe"' if os.name == 'nt' else 'mysql'} --defaults-extra-file={mysqlcnf} {mysql['base']} < {cwd}/export/{file}', shell=True, check=True)
                except:
                    PrintError(f'Failed to import {file}')

    PrintHeader('Finished importing base data')

UpdateSource()
DropTables()
ImportTables()
ImportUpdates()
ImportData()
CreateBaseFiles()
ExportData()
ImportExportedData()
ImportExportedData()

if os.path.exists(mysqlcnf):
    os.remove(mysqlcnf)
